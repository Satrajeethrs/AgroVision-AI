<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - AI-Powered Crop Recommendation System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='results.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="results-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>🌾 Analysis Results</h3>
            </div>
            <div class="sidebar-menu">
                <button class="sidebar-btn active" data-section="executive-summary">
                    📋 Executive Summary
                </button>
                <button class="sidebar-btn" data-section="crop-recommendation">
                    🌱 Crop Recommendation
                </button>
                <button class="sidebar-btn" data-section="fertilizer-recommendation">
                    🧪 Fertilizer Recommendation
                </button>
                <button class="sidebar-btn" data-section="soil-health">
                    🌿 Soil Health Management
                </button>
                {% if disease_info %}
                <button class="sidebar-btn" data-section="disease-analysis">
                    🔍 Disease Analysis
                </button>
                {% endif %}
            </div>
            <div class="sidebar-actions">
                <button class="btn btn-primary w-100 mb-2" onclick="window.location.href='/'">
                    🔄 New Analysis
                </button>
                <button class="btn btn-outline-primary w-100" onclick="printCurrentSection()">
                    🖨️ Print Current Section
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Executive Summary Section -->
            <div class="content-section active" id="executive-summary">
                <div class="section-header">
                    <h2>📋 Executive Summary</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.executive_summary.content | safe }}
                    {% if advice_sections.ai_alternative %}
                    <div class="mt-3">{{ advice_sections.ai_alternative.content | safe }}</div>
                    {% endif %}
                </div>
            </div>

            {% if advice_sections.ai_narrative %}
            <div class="content-section" id="ai-narrative">
                <div class="section-header">
                    <h2>🧾 AI Narrative</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.ai_narrative.content | safe }}
                    {% if advice_sections.ai_narrative.meta and advice_sections.ai_narrative.meta.provider %}
                    <div class="ai-meta mt-3 small text-muted">
                        <div>Provider: <strong>{{ advice_sections.ai_narrative.meta.provider }}</strong></div>
                        <button class="btn btn-sm btn-outline-secondary mt-2" id="toggle-raw">Show raw response</button>
                        <pre id="raw-output" class="mt-2" style="display:none; white-space:pre-wrap; background:#f8f9fa; padding:8px; border-radius:4px;">{{ advice_sections.ai_narrative.meta.raw }}</pre>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <div class="content-section" id="validation-panel">
                <div class="section-header">
                    <h2>🔎 On-demand Validation</h2>
                </div>
                <div class="section-content">
                    <button id="btn-validate" class="btn btn-primary">Validate recommendations</button>
                    <div id="validation-results" class="mt-3"></div>
                </div>
            </div>

            <!-- Crop Recommendation Section -->
            <div class="content-section" id="crop-recommendation">
                <div class="section-header">
                    <h2>🌱 Crop Recommendation Analysis</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.crop_recommendation.content | safe }}
                    {% if advice_sections.ai_alternative %}
                    <div class="mt-3">
                        {{ advice_sections.ai_alternative.content | safe }}
                        {% if advice_sections.ai_alternative.meta and advice_sections.ai_alternative.meta.provider %}
                        <div class="small text-muted">Provider: {{ advice_sections.ai_alternative.meta.provider }}</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Fertilizer Recommendation Section -->
            <div class="content-section" id="fertilizer-recommendation">
                <div class="section-header">
                    <h2>🧪 Smart Fertilizer Recommendation</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.fertilizer_recommendation.content | safe }}
                    {% if advice_sections.ai_alternative %}
                    <div class="mt-3">{{ advice_sections.ai_alternative.content | safe }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Soil Health Section -->
            <div class="content-section" id="soil-health">
                <div class="section-header">
                    <h2>🌿 Soil Health Management</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.soil_health.content | safe }}
                    {% if advice_sections.ai_alternative %}
                    <div class="mt-3">{{ advice_sections.ai_alternative.content | safe }}</div>
                    {% endif %}
                </div>
            </div>

            <!-- Disease Analysis Section -->
            {% if disease_info %}
            <div class="content-section" id="disease-analysis">
                <div class="section-header">
                    <h2>🔍 Disease Analysis</h2>
                </div>
                <div class="section-content">
                    {{ advice_sections.disease_analysis.content | safe }}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='results.js') }}"></script>
</body>
</html>