<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Crop Recommendation System for Karnataka Farmers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="{{ url_for('static', filename='validation.js') }}" defer></script>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="container">
            <h1 class="text-center">üåæ AI-Powered Crop Recommendation System</h1>
            <p class="lead text-center">Get personalized crop recommendations based on your soil and climate conditions</p>
            <div class="text-center">
                <span class="badge bg-light text-dark me-2">Karnataka Farmers</span>
                <span class="badge bg-light text-dark me-2">ML-Powered</span>
                <span class="badge bg-light text-dark me-2">Professional</span>
                <span class="badge bg-light text-dark">Real-time Analysis</span>
            </div>
        </div>
    </div>

    <!-- Main Content with Sidebar Navigation -->
    <div class="container-fluid">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <!-- Welcome Card -->
                <div class="card welcome-card mt-4">
                    <div class="card-body">
                        <h5>üöÄ Welcome to Smart Agricultural Advisory</h5>
                        <p>This AI-powered system provides comprehensive agricultural guidance including crop recommendations, fertilizer suggestions, and plant disease detection specifically designed for Karnataka farmers.</p>
                    </div>
                </div>

                <!-- Input Form -->
                <div class="card form-card mt-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">
                            <span class="form-section-number">1</span>
                            üìä Enter Your Farm Conditions
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if error_message %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <strong>Error:</strong> {{ error_message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endif %}
                        <form method="POST" action="{{ url_for('analyze') }}" id="cropForm" enctype="multipart/form-data">
                            <!-- Plant Disease Detection Section -->
                            <div class="col-md-12 mt-4">
                                <h6 class="text-success mb-3">üåø Plant Disease Detection (Upload Image)</h6>
                                <div class="mb-3">
                                    <label for="disease_image" class="form-label">Upload Plant Leaf Image (JPG/PNG):</label>
                                    <input class="form-control" type="file" id="disease_image" name="disease_image" accept="image/*">
                                    <div class="form-text">Optional: Upload a plant image to detect disease and get treatment advice.</div>
                                </div>
                            </div>
                            <div class="row">
                                <!-- Soil Nutrients Section -->
                                <div class="col-md-12">
                                    <h6 class="text-primary mb-3">üß™ Soil Nutrient Analysis</h6>
                                </div>
                                <div class="col-md-4 form-group mb-3">
                                    <label for="N" class="form-label">Nitrogen (N) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="N" name="N" step="0.1" min="0" max="200" required value="90">
                                        <span class="input-group-text">kg/ha</span>
                                    </div>
                                    <div class="form-text">Typical range: 0-200 kg/ha</div>
                                </div>
                                <div class="col-md-4 form-group mb-3">
                                    <label for="P" class="form-label">Phosphorus (P) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="P" name="P" step="0.1" min="0" max="150" required value="42">
                                        <span class="input-group-text">kg/ha</span>
                                    </div>
                                    <div class="form-text">Typical range: 5-150 kg/ha</div>
                                </div>
                                <div class="col-md-4 form-group mb-3">
                                    <label for="K" class="form-label">Potassium (K) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="K" name="K" step="0.1" min="0" max="200" required value="43">
                                        <span class="input-group-text">kg/ha</span>
                                    </div>
                                    <div class="form-text">Typical range: 5-200 kg/ha</div>
                                </div>

                                <!-- Climate Conditions Section -->
                                <div class="col-md-12 mt-3">
                                    <h6 class="text-primary mb-3">üå°Ô∏è Climate Conditions</h6>
                                </div>
                                <div class="col-md-3 form-group mb-3">
                                    <label for="temperature" class="form-label">Temperature *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="temperature" name="temperature" step="0.1" min="15" max="45" required value="26">
                                        <span class="input-group-text">¬∞C</span>
                                    </div>
                                    <div class="form-text">Range: 15-45¬∞C</div>
                                </div>
                                <div class="col-md-3 form-group mb-3">
                                    <label for="humidity" class="form-label">Humidity *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="humidity" name="humidity" step="0.1" min="30" max="100" required value="80">
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <div class="form-text">Range: 30-100%</div>
                                </div>
                                <div class="col-md-3 form-group mb-3">
                                    <label for="ph" class="form-label">Soil pH *</label>
                                    <input type="number" class="form-control" id="ph" name="ph" step="0.1" min="3" max="10" required value="6.5">
                                    <div class="form-text">Range: 3.0-10.0</div>
                                </div>
                                <div class="col-md-3 form-group mb-3">
                                    <label for="rainfall" class="form-label">Annual Rainfall *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="rainfall" name="rainfall" step="0.1" min="100" max="3000" required value="1200">
                                        <span class="input-group-text">mm</span>
                                    </div>
                                    <div class="form-text">Range: 100-3000mm</div>
                                </div>

                                <!-- Soil Health Section -->
                                <div class="col-md-12 mt-3">
                                    <h6 class="text-primary mb-3">üå± Soil Health Indicator</h6>
                                </div>
                                <div class="col-md-6 form-group mb-3">
                                    <label for="SOC" class="form-label">Soil Organic Carbon (SOC) *</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="SOC" name="SOC" step="0.01" min="0.1" max="3" required value="0.6">
                                        <span class="input-group-text">%</span>
                                    </div>
                                    <div class="form-text">Range: 0.1-3.0% (Healthy: >0.5%)</div>
                                </div>

                                <!-- Disease Detection Section -->
                                <div class="col-md-12 mt-3">
                                    <div class="disease-section highlight-section">
                                        <h6 class="text-warning mb-3">üîç Plant Disease Detection (Optional)</h6>
                                        <div class="form-group">
                                            <label for="disease_symptoms" class="form-label">Describe Plant Symptoms</label>
                                            <textarea class="form-control" id="disease_symptoms" name="disease_symptoms" rows="2" 
                                                placeholder="e.g., yellowing leaves, brown spots, wilting, holes in leaves, white fungal growth..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <button type="submit" class="btn btn-success btn-lg px-5">
                                    üéØ Get AI-Powered Agricultural Advisory
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Results Section -->
                {% if advice_sections %}
                <div id="results-section" class="mt-4">
                    {% for section_id, data in advice_sections.items() %}
                    <div class="report-section-card" id="{{ section_id }}">
                        <div class="card-header">
                            <h5>{{ data.title|safe }}</h5>
                        </div>
                        <div class="card-body">
                            {{ data.content|safe }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Right Sidebar Navigation -->
            <div class="col-lg-3 col-md-4">
                <div class="sidebar-nav" id="sidebar-nav">
                    <div class="nav-header">
                        <h6>üìã Report Navigation</h6>
                    </div>
                    
                    <div class="nav-sections">
                        <div class="nav-item active" data-target="all">
                            <div class="nav-icon">üìú</div>
                            <div class="nav-content">
                                <div class="nav-title">Full Report</div>
                                <div class="nav-subtitle">View all sections</div>
                            </div>
                        </div>
                         <div class="nav-item" data-target="executive_summary">
                            <div class="nav-icon">üìã</div>
                            <div class="nav-content">
                                <div class="nav-title">Executive Summary</div>
                                <div class="nav-subtitle">Key takeaways</div>
                            </div>
                        </div>
                        <div class="nav-item" data-target="crop_recommendation">
                            <div class="nav-icon">üå±</div>
                            <div class="nav-content">
                                <div class="nav-title">Crop Recommendation</div>
                                <div class="nav-subtitle">AI-powered crop selection</div>
                            </div>
                        </div>
                        <div class="nav-item" data-target="fertilizer_plan">
                            <div class="nav-icon">üß™</div>
                            <div class="nav-content">
                                <div class="nav-title">Fertilizer Plan</div>
                                <div class="nav-subtitle">NPK & organic inputs</div>
                            </div>
                        </div>
                        <div class="nav-item" data-target="soil_health">
                            <div class="nav-icon">üåç</div>
                            <div class="nav-content">
                                <div class="nav-title">Soil Health</div>
                                <div class="nav-subtitle">SOC analysis</div>
                            </div>
                        </div>
                        <div class="nav-item" data-target="disease_analysis">
                            <div class="nav-icon">üî¨</div>
                            <div class="nav-content">
                                <div class="nav-title">Disease Analysis</div>
                                <div class="nav-subtitle">AI disease detection</div>
                            </div>
                        </div>
                        <div class="nav-item" data-target="karnataka_guidelines">
                            <div class="nav-icon">üèõÔ∏è</div>
                            <div class="nav-content">
                                <div class="nav-title">Karnataka Guidelines</div>
                                <div class="nav-subtitle">Regional optimization</div>
                            </div>
                        </div>
                    </div>

                    <div class="nav-actions">
                        <button class="btn btn-sm btn-outline-primary w-100 mb-2" onclick="window.print()">
                            üñ®Ô∏è Print Report
                        </button>
                        <button class="btn btn-sm btn-outline-secondary w-100" onclick="scrollToTop()">
                            ‚¨ÜÔ∏è Back to Top
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navItems = document.querySelectorAll('.sidebar-nav .nav-item');
            const reportSections = document.querySelectorAll('.report-section-card');
            const resultsContainer = document.getElementById('results-section');

            // Hide sections that don't exist in the report
            navItems.forEach(item => {
                const targetId = item.getAttribute('data-target');
                if (targetId !== 'all' && !document.getElementById(targetId)) {
                    item.style.display = 'none';
                }
            });

            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');

                    // Manage active state for nav items
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');

                    // Show/hide report sections
                    if (targetId === 'all') {
                        reportSections.forEach(section => section.style.display = 'block');
                    } else {
                        reportSections.forEach(section => {
                            section.style.display = section.id === targetId ? 'block' : 'none';
                        });
                    }
                    
                    // Scroll to the top of the results container
                    if(resultsContainer) {
                        resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                });
            });

            // Form submission UX
            const form = document.getElementById('cropForm');
            if (form) {
                form.addEventListener('submit', function() {
                    const button = this.querySelector('button[type="submit"]');
                    button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analyzing...';
                    button.disabled = true;
                });
            }
        });

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
